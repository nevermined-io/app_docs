"use strict";(self.webpackChunkapp_docs=self.webpackChunkapp_docs||[]).push([[509],{7362:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>p,toc:()=>u});var i=t(5893),r=t(1151),s=t(7294),o=t(7691);function a(){const[e,n]=(0,s.useState)(!1),[t,r]=(0,s.useState)(!1),[a,c]=(0,s.useState)(""),d=(0,s.useRef)(new o.Payments({returnUrl:"https://docs.nevermined.app/docs/tutorials/integration/nextjs-react-payments#try-it-out",environment:"staging"}));return(0,s.useEffect)((()=>{d.current.init()}),[]),(0,s.useEffect)((()=>{d.current.isLoggedIn&&n(!0)}),[d.current.isLoggedIn]),(0,i.jsx)("main",{children:(0,i.jsxs)("div",{children:[(0,i.jsx)("button",{onClick:()=>{d.current.connect()},children:"Login"}),(0,i.jsx)("p",{children:e?"Logged in":"Not logged in"}),(0,i.jsx)("button",{onClick:async function(){if(d.current.isLoggedIn){r(!0);const{did:e}=await d.current.createSubscription({name:"test subscription",description:"test",price:10000000n,tokenAddress:"0x75faf114eafb1BDbe2F0316DF893fd58CE46AA4d",duration:30,tags:["test"]});r(!1),c(e)}},children:"Create Subscription"}),(0,i.jsx)("p",{children:t&&""===a?"Creating Subscription, please wait a few seconds...":(0,i.jsx)("a",{href:`https://staging.nevermined.app/subscription/${a}`,children:a})})]})})}const c={sidebar_position:3,description:"How to integrate the Nevermined Payments library in a react application"},d="Tutorial on how to use the Nevermined Payments Protocol in a React app",p={id:"tutorials/integration/nextjs-react-payments",title:"Tutorial on how to use the Nevermined Payments Protocol in a React app",description:"How to integrate the Nevermined Payments library in a react application",source:"@site/docs/tutorials/integration/nextjs-react-payments.mdx",sourceDirName:"tutorials/integration",slug:"/tutorials/integration/nextjs-react-payments",permalink:"/docs/tutorials/integration/nextjs-react-payments",draft:!1,unlisted:!1,editUrl:"https://github.com/nevermined-io/app_docs/tree/main/docs/tutorials/integration/nextjs-react-payments.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,description:"How to integrate the Nevermined Payments library in a react application"},sidebar:"tutorialSidebar",previous:{title:"Using the Nvm App API",permalink:"/docs/tutorials/integration/api-integration"},next:{title:"For Web3 users",permalink:"/docs/tutorials/web3/"}},l={},u=[{value:"Initializing the project",id:"initializing-the-project",level:3},{value:"Initialize the payments library",id:"initialize-the-payments-library",level:3},{value:"Create a subscription",id:"create-a-subscription",level:3},{value:"Try it out",id:"try-it-out",level:3},{value:"Full code",id:"full-code",level:3}];function m(e){const n={a:"a",code:"code",h1:"h1",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"tutorial-on-how-to-use-the-nevermined-payments-protocol-in-a-react-app",children:"Tutorial on how to use the Nevermined Payments Protocol in a React app"}),"\n",(0,i.jsx)(n.h3,{id:"initializing-the-project",children:"Initializing the project"}),"\n",(0,i.jsxs)(n.p,{children:["For this tutorial we will be using ",(0,i.jsx)(n.a,{href:"https://nextjs.org/docs/getting-started/installation",children:"nextjs"}),"\ncreate our react application."]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Initialize the react project"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"npx create-next-app@latest\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsxs)(n.li,{children:["Install the Nevermined ",(0,i.jsx)(n.a,{href:"https://github.com/nevermined-io/payments",children:"payments library"})]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"yarn add @nevermined-io/payments\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"Starting the development server"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"yarn dev\n"})}),"\n",(0,i.jsx)(n.h3,{id:"initialize-the-payments-library",children:"Initialize the payments library"}),"\n",(0,i.jsxs)(n.p,{children:["In order to initialize the payments library we need to have the user login to Nevermined. This can\nbe achieved by calling the ",(0,i.jsx)(n.code,{children:"connect"})," method that will redirect the user to the Nevermined for Login\nand once the user is returned to the app calling the ",(0,i.jsx)(n.code,{children:"init"})," method to finalize the initialization of\nthe payments library."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",metastring:'title="/app/page.tsx"',children:"'use client'\n\nimport { useEffect } from 'react'\nimport { Payments } from '@nevermined-io/payments'\n\nexport default function Home() {\n  const payments = new Payments({\n    returnUrl:\n      'https://docs.nevermined.app/docs/tutorials/integration/nextjs-react-payments#try-it-out',\n    environment: 'staging',\n  })\n\n  const onLogin = () => {\n    payments.connect()\n  }\n\n  useEffect(() => {\n    payments.init()\n  }, [])\n\n  return (\n    <main>\n      <div>\n        <button onClick={onLogin}>Login</button>\n      </div>\n    </main>\n  )\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"create-a-subscription",children:"Create a subscription"}),"\n",(0,i.jsx)(n.p,{children:"Once the app is initialized we can start interacting with the Nevermined Payments Protocol. Here is\na example for creating a subscription"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",metastring:'title="/app/page.tsx"',children:"  ...\n\n  async function createSubscription() {\n    if (payments.isLoggedIn) {\n      const { did } = await payments.createSubscription({\n        name: 'test subscription',\n        description: 'test',\n        price: 10000000n,\n        tokenAddress: '0x75faf114eafb1BDbe2F0316DF893fd58CE46AA4d',\n        duration: 30,\n        tags: ['test'],\n      })\n    }\n\n    return (\n    <main>\n      <div>\n        <button onClick={onLogin}>Login</button>\n        <button onClick={createSubscription}>Create Subscription</button>\n      </div>\n    </main>\n  )\n  }\n"})}),"\n",(0,i.jsx)(n.h3,{id:"try-it-out",children:"Try it out"}),"\n",(0,i.jsx)(a,{}),"\n",(0,i.jsx)(n.h3,{id:"full-code",children:"Full code"}),"\n",(0,i.jsxs)(n.p,{children:["For the full nextjs example please check\n",(0,i.jsx)(n.a,{href:"https://github.com/nevermined-io/tutorials/tree/main/payments-nextjs-example",children:"payments-nextjs-example"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",metastring:'title="app/page.tsx"',children:"import { useEffect, useState, useRef } from 'react'\nimport { Payments } from '@nevermined-io/payments'\n\nexport default function PaymentsTutorial() {\n  const [isUserLoggedIn, setIsUserLoggedIn] = useState<boolean>(false)\n  const [creatingSubscription, setCreatingSubscription] = useState<boolean>(false)\n  const [did, setDid] = useState<string>('')\n\n  const payments = useRef(\n    new Payments({\n      returnUrl:\n        'https://docs.nevermined.app/docs/tutorials/integration/nextjs-react-payments#try-it-out',\n      environment: 'staging',\n    }),\n  )\n\n  const onLogin = () => {\n    payments.current.connect()\n  }\n\n  useEffect(() => {\n    payments.current.init()\n  }, [])\n\n  useEffect(() => {\n    if (payments.current.isLoggedIn) {\n      setIsUserLoggedIn(true)\n    }\n  }, [payments.current.isLoggedIn])\n\n  async function createSubscription() {\n    if (payments.current.isLoggedIn) {\n      setCreatingSubscription(true)\n      const { did } = await payments.current.createSubscription({\n        name: 'test subscription',\n        description: 'test',\n        price: 10000000n,\n        tokenAddress: '0x75faf114eafb1BDbe2F0316DF893fd58CE46AA4d',\n        duration: 30,\n        tags: ['test'],\n      })\n      setCreatingSubscription(false)\n      setDid(did)\n    }\n  }\n\n  return (\n    <main>\n      <div>\n        <button onClick={onLogin}>Login</button>\n        <p>{isUserLoggedIn ? 'Logged in' : 'Not logged in'}</p>\n        <button onClick={createSubscription}>Create Subscription</button>\n        <p>\n          {creatingSubscription && did === '' ? (\n            'Creating Subscription, please wait a few seconds...'\n          ) : (\n            <a href={`https://staging.nevermined.app/subscription/${did}`}>{did}</a>\n          )}\n        </p>\n      </div>\n    </main>\n  )\n}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(m,{...e})}):m(e)}},5699:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.Environments=void 0,n.Environments={staging:{frontend:"https://staging.nevermined.app",backend:"https://one-backend.staging.nevermined.app"}}},7691:function(e,n,t){var i=this&&this.__createBinding||(Object.create?function(e,n,t,i){void 0===i&&(i=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,i,r)}:function(e,n,t,i){void 0===i&&(i=t),e[i]=n[t]}),r=this&&this.__exportStar||function(e,n){for(var t in e)"default"===t||Object.prototype.hasOwnProperty.call(n,t)||i(n,e,t)};Object.defineProperty(n,"__esModule",{value:!0}),r(t(8661),n),r(t(5699),n)},8661:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.Payments=void 0;const i=t(5699);n.Payments=class{constructor(e){this.returnUrl=e.returnUrl,this.environment=i.Environments[e.environment]}init(){const e=new URL(window.location.href),n=e.searchParams.get("sessionKey");n&&(this.sessionKey=n,console.log("sessionKey:",n),e.searchParams.delete("sessionKey"),history.replaceState(history.state,"",e.toString()))}connect(){const e=new URL(`/en/login?nvm-export=session-key&returnUrl=${this.returnUrl}`,this.environment.frontend);window.location.href=e.toString()}get isLoggedIn(){return!!this.sessionKey}async createSubscription({name:e,description:n,price:t,tokenAddress:i,amountOfCredits:r,duration:s,tags:o}){const a={sessionKey:this.sessionKey,name:e,description:n,price:t.toString(),tokenAddress:i,amountOfCredits:r,duration:s,tags:o},c={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a)},d=new URL("/api/v1/payments/subscription",this.environment.backend),p=await fetch(d,c);if(!p.ok)throw Error(p.statusText);return p.json()}async createWebservice({subscriptionDid:e,name:n,description:t,price:i,tokenAddress:r,amountOfCredits:s,duration:o,tags:a,serviceChargeType:c,minCreditsToCharge:d,maxCreditsToCharge:p,authType:l,username:u,password:m,token:h,endpoints:g,openEndpoints:y,openApiUrl:f,integration:b,sampleLink:x,apiDescription:v,curation:j}){const w={sessionKey:this.sessionKey,name:n,description:t,price:i.toString(),tokenAddress:r,amountOfCredits:s,duration:o,tags:a,subscriptionDid:e,serviceChargeType:c,minCreditsToCharge:d,maxCreditsToCharge:p,authType:l,username:u,password:m,token:h,endpoints:g,openEndpoints:y,openApiUrl:f,integration:b,sampleLink:x,apiDescription:v,curation:j};console.log(w);const C={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(w)},S=new URL("/api/v1/payments/webservice",this.environment.backend),k=await fetch(S,C);if(!k.ok)throw Error(k.statusText);return k.json()}}},1151:(e,n,t)=>{t.d(n,{Z:()=>a,a:()=>o});var i=t(7294);const r={},s=i.createContext(r);function o(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);