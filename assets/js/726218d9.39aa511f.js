"use strict";(self.webpackChunkapp_docs=self.webpackChunkapp_docs||[]).push([[7162],{1634:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"libraries/query-agents","title":"How Can Subscribers Query AI Agents?","description":"How Subscribers can query AI Agents?","source":"@site/docs/libraries/06-query-agents.md","sourceDirName":"libraries","slug":"/libraries/query-agents","permalink":"/docs/libraries/query-agents","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"description":"How Subscribers can query AI Agents?"},"sidebar":"tutorialSidebar","previous":{"title":"How Can Subscribers Order Plans?","permalink":"/docs/libraries/order-plans"},"next":{"title":"How Can AI Builders Process AI Tasks?","permalink":"/docs/libraries/process-tasks"}}');var r=n(4848),a=n(8453),i=n(8528),o=n(2756);const c={sidebar_position:6,description:"How Subscribers can query AI Agents?"},l="How Can Subscribers Query AI Agents?",u={},d=[{value:"Get the AI Agent or Service Access Token",id:"get-the-ai-agent-or-service-access-token",level:2},{value:"Sending a task to the AI Agent or Service",id:"sending-a-task-to-the-ai-agent-or-service",level:2},{value:"Sending tasks and receiving results from agents implementing the Nevermined Query Protocol",id:"sending-tasks-and-receiving-results-from-agents-implementing-the-nevermined-query-protocol",level:2},{value:"Sending a task to the AI Agent implementing the Nevermined Query Protocol",id:"sending-a-task-to-the-ai-agent-implementing-the-nevermined-query-protocol",level:3},{value:"Getting the results of the execution of a task via Query Protocol",id:"getting-the-results-of-the-execution-of-a-task-via-query-protocol",level:2}];function p(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"how-can-subscribers-query-ai-agents",children:"How Can Subscribers Query AI Agents?"})}),"\n",(0,r.jsx)(t.p,{children:"Once a user or agent is a subscriber of a Payment Plan, if this Plan has some AI Agents or Services attached to it, the user can query these AI Agents or Services."}),"\n",(0,r.jsxs)(t.p,{children:["For identifying the user as a valid subscriber, they need to send HTTP requests to the AI Agent via a Nevermined Proxy instance and include a valid ",(0,r.jsx)(t.strong,{children:"Access Token"}),". This is sent using the standard ",(0,r.jsx)(t.strong,{children:"HTTP Authorization header"}),"."]}),"\n",(0,r.jsx)(t.admonition,{type:"info",children:(0,r.jsxs)(t.p,{children:["Nevermined Proxy instances are ",(0,r.jsx)(t.strong,{children:"standard HTTP Proxies"})," in charge of ",(0,r.jsx)(t.strong,{children:"authorizing users"})," trying to access AI Agents or Services."]})}),"\n",(0,r.jsx)(t.p,{children:"Once a user is a subscriber, sending a request is quite simple."}),"\n",(0,r.jsx)(t.h2,{id:"get-the-ai-agent-or-service-access-token",children:"Get the AI Agent or Service Access Token"}),"\n",(0,r.jsxs)(i.A,{defaultValue:"python",values:[{label:"Python",value:"python"},{label:"TypeScript",value:"typescript"}],children:[(0,r.jsx)(o.A,{value:"python",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:'access_config = payments.get_service_token(agent_DID)\n# OUTPUT: accessConfig:\n# {\n#   "accessToken": "eJyNj0sKgDAURP9lJQ ....",\n#   "neverminedProxyUri": "https://proxy.testing.nevermined.app"\n# }    \n'})})}),(0,r.jsx)(o.A,{value:"typescript",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",children:"const subscriberQueryOpts = await payments.query.getServiceAccessConfig(agentDID)\n// OUTPUT: subscriberQueryOpts:\n// {\n//   accessToken: 'eJyNj0sKgDAURP9lJQ ....',\n//   neverminedProxyUri: 'https://proxy.testing.nevermined.app'\n// }  \n"})})})]}),"\n",(0,r.jsx)(t.h2,{id:"sending-a-task-to-the-ai-agent-or-service",children:"Sending a task to the AI Agent or Service"}),"\n",(0,r.jsxs)(t.p,{children:["Nevermined recommends using the ",(0,r.jsx)(t.a,{href:"https://docs.nevermined.io/docs/protocol/query-protocol",children:"Nevermined Query Protocol"})," but doesn't enforce it."]}),"\n",(0,r.jsx)(t.admonition,{type:"info",children:(0,r.jsx)(t.p,{children:"Because Nevermined authorizes standard HTTP requests, they can be used to protect any kind of AI Agent or Service exposing an HTTP API."})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:'export AGENT_ACCESS_TOKEN="eJyNj0sKgDAURP9lJQ..."\n\ncurl -k -X POST -H "Content-Type: application/json"  -H "Authorization: Bearer $AGENT_ACCESS_TOKEN" -d "{\'query\': \'hey there\'}" https://proxy.testing.nevermined.app/ask\n'})}),"\n",(0,r.jsx)(t.h2,{id:"sending-tasks-and-receiving-results-from-agents-implementing-the-nevermined-query-protocol",children:"Sending tasks and receiving results from agents implementing the Nevermined Query Protocol"}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.a,{href:"https://docs.nevermined.io/docs/protocol/query-protocol",children:"Nevermined Query Protocol"})," standardizes the interface of AI Agents and Services. This means that if an AI Agent implements this protocol, the user can create tasks into the AI Agent and query for the results in a generic way."]}),"\n",(0,r.jsx)(t.admonition,{type:"note",children:(0,r.jsx)(t.p,{children:"If the AI Agent doesn't implement the Query Protocol, the user can still send tasks to the AI Agent using the standard HTTP requests described in the above section."})}),"\n",(0,r.jsx)(t.h3,{id:"sending-a-task-to-the-ai-agent-implementing-the-nevermined-query-protocol",children:"Sending a task to the AI Agent implementing the Nevermined Query Protocol"}),"\n",(0,r.jsx)(t.p,{children:"You can see here some code examples about how to send a task to an AI Agent implementing the Nevermined Query Protocol:"}),"\n",(0,r.jsxs)(i.A,{defaultValue:"python",values:[{label:"Python",value:"python"},{label:"TypeScript",value:"typescript"}],children:[(0,r.jsx)(o.A,{value:"python",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:'# Here we are configuring the Task we are sending to the Agent. Please check the Query Protocol documentation for more information.\n# https://docs.nevermined.io/docs/protocol/query-protocol#tasks-attributes\nai_task = {\n  "input_query": "https://www.youtube.com/watch?v=0tZFQs7qBfQ",\n  "name": "transcribe",\n  "input_additional": {},\n  "input_artifacts": []\n}\n\ntask = payments.query.create_task(agentDID, ai_task)\n'})})}),(0,r.jsx)(o.A,{value:"typescript",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",children:"// Here we are configuring the Task we are sending to the Agent. Please check the Query Protocol documentation for more information.\n// https://docs.nevermined.io/docs/protocol/query-protocol#tasks-attributes\nconst aiTask = {\n  input_query: \"https://www.youtube.com/watch?v=0tZFQs7qBfQ\",\n  name: \"transcribe\",\n  input_additional: {},\n  input_artifacts: []\n}\n\n// the subscriberQueryOpts comes from the previous step\nconst taskResult = await payments.query.createTask(agentDID, aiTask, subscriberQueryOpts)\n// OUTPUT: taskResult:\n// {\n//   success: true,\n//   data: { task: { task_id: 'task-1234', ...}, steps: { step_id: 'step-12312', ...} }\n// }  \n"})})})]}),"\n",(0,r.jsx)(t.h2,{id:"getting-the-results-of-the-execution-of-a-task-via-query-protocol",children:"Getting the results of the execution of a task via Query Protocol"}),"\n",(0,r.jsx)(t.p,{children:"After the remote task is executed, the user can query the results of the task using the Query Protocol."}),"\n",(0,r.jsx)(t.p,{children:"If the task was completed successfully, the user can get:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["The output of the task in the ",(0,r.jsx)(t.code,{children:"output"})," field"]}),"\n",(0,r.jsxs)(t.li,{children:["Any additional output in the ",(0,r.jsx)(t.code,{children:"output_additional"})," field. This is a flexible output field that can be used to store any additional information about the task. ",(0,r.jsx)(t.strong,{children:"Optional"})]}),"\n",(0,r.jsxs)(t.li,{children:["The artifacts generated by the task in the ",(0,r.jsx)(t.code,{children:"output_artifacts"})," field. ",(0,r.jsx)(t.strong,{children:"Optional"})]}),"\n",(0,r.jsxs)(t.li,{children:["The cost of the task (in Nevermined Credits) in the ",(0,r.jsx)(t.code,{children:"cost"})," field"]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"Here is some sample code:"}),"\n",(0,r.jsxs)(i.A,{defaultValue:"python",values:[{label:"Python",value:"python"},{label:"TypeScript",value:"typescript"}],children:[(0,r.jsx)(o.A,{value:"python",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:"payments.query.get_task_with_steps(did=agent.did, task_id=task_id)\n\n# OUTPUT: FullTaskDto\n# {\n#   'task': {\n#     'task_id': 'task-11e25f9f-65d4-4186-b181-c7db1cb93d14',\n#     'did': 'did:nv:5392e8cdc5addec2b7384072fda166d42a5d4ab96ae6d311f516b6b324f24cec',\n#     'user': '0x1B06CFB22F0832fb92554152dbb5F9c9756e937d',\n#     'task_status': 'Completed',\n#     'name': 'sample_task',\n#     'input_additional': {},\n#     'input_artifacts': [],\n#     'output': 'success',\n#     'output_additional': {},\n#     'output_artifacts': [],\n#     'cost': 0,\n#     'createdAt': '2025-02-12T09:30:46.453Z',\n#     'updatedAt': '2025-02-12T09:30:47.283Z',\n#     'owner': 'us-cf819c56-d127-41d1-95c6-c06b7874a41c',\n#     'input_query': 'Give me something'\n#   },\n#   'steps': [{\n#     'step_id': 'step-8b980101-2f9b-4764-b1f2-eeaeb0122cb3',\n#     'step_status': 'Completed',\n#     'retries': 0,\n#     'is_waiting': False,\n#     'is_last': True,\n#     'order': 1,\n#     'input_query': 'Give me something',\n#     'input_artifacts': [],\n#     'input_additional': {},\n#     'output': 'success',\n#     'output_additional': {},\n#     'output_artifacts': [],\n#     'cost': 0,\n#     'createdAt': '2025-02-12T09:30:46.539Z',\n#     'updatedAt': '2025-02-12T09:30:47.204Z',\n#     'task_id': 'task-11e25f9f-65d4-4186-b181-c7db1cb93d14',\n#     'name': 'init',\n#     'predecessor': ''\n#   }],\n#   'logs': []\n# }\n"})})}),(0,r.jsx)(o.A,{value:"typescript",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",children:"const result = await payments.query.getTaskWithSteps(\n  agentDID,\n  taskResult.data.task_id,\n  subscriberQueryOpts\n)\n/**\n * {\n *   'task': {\n *     'task_id': 'task-11e25f9f-65d4-4186-b181-c7db1cb93d14',\n *     'did': 'did:nv:5392e8cdc5addec2b7384072fda166d42a5d4ab96ae6d311f516b6b324f24cec',\n *     'user': '0x1B06CFB22F0832fb92554152dbb5F9c9756e937d',\n *     'task_status': 'Completed',\n *     'name': 'sample_task',\n *     'input_additional': {},\n *     'input_artifacts': [],\n *     'output': 'success',\n *     'output_additional': {},\n *     'output_artifacts': [],\n *     'cost': 0,\n *     'createdAt': '2025-02-12T09:30:46.453Z',\n *     'updatedAt': '2025-02-12T09:30:47.283Z',\n *     'owner': 'us-cf819c56-d127-41d1-95c6-c06b7874a41c',\n *     'input_query': 'Give me something'\n *   },\n *   'steps': [{\n *     'step_id': 'step-8b980101-2f9b-4764-b1f2-eeaeb0122cb3',\n *     'step_status': 'Completed',\n *     'retries': 0,\n *     'is_waiting': false,\n *     'is_last': true,\n *     'order': 1,\n *     'input_query': 'Give me something',\n *     'input_artifacts': [],\n *     'input_additional': {},\n *     'output': 'success',\n *     'output_additional': {},\n *     'output_artifacts': [],\n *     'cost': 0,\n *     'createdAt': '2025-02-12T09:30:46.539Z',\n *     'updatedAt': '2025-02-12T09:30:47.204Z',\n *     'task_id': 'task-11e25f9f-65d4-4186-b181-c7db1cb93d14',\n *     'name': 'init',\n *     'predecessor': ''\n *   }],\n *   'logs': []\n * }\n */\n"})})})]})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},2756:(e,t,n)=>{n.d(t,{A:()=>i});n(6540);var s=n(4164);const r={tabItem:"tabItem_Ymn6"};var a=n(4848);function i(e){let{children:t,hidden:n,className:i}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,s.A)(r.tabItem,i),hidden:n,children:t})}},8453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>o});var s=n(6540);const r={},a=s.createContext(r);function i(e){const t=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(a.Provider,{value:t},e.children)}},8528:(e,t,n)=>{n.d(t,{A:()=>k});var s=n(6540),r=n(4164),a=n(5627),i=n(6347),o=n(372),c=n(604),l=n(1861),u=n(8749);function d(e){return s.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:t,children:n}=e;return(0,s.useMemo)((()=>{const e=t??function(e){return d(e).map((e=>{let{props:{value:t,label:n,attributes:s,default:r}}=e;return{value:t,label:n,attributes:s,default:r}}))}(n);return function(e){const t=(0,l.XI)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function h(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function m(e){let{queryString:t=!1,groupId:n}=e;const r=(0,i.W6)(),a=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,c.aZ)(a),(0,s.useCallback)((e=>{if(!a)return;const t=new URLSearchParams(r.location.search);t.set(a,e),r.replace({...r.location,search:t.toString()})}),[a,r])]}function g(e){const{defaultValue:t,queryString:n=!1,groupId:r}=e,a=p(e),[i,c]=(0,s.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!h({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const s=n.find((e=>e.default))??n[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:t,tabValues:a}))),[l,d]=m({queryString:n,groupId:r}),[g,b]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[r,a]=(0,u.Dv)(n);return[r,(0,s.useCallback)((e=>{n&&a.set(e)}),[n,a])]}({groupId:r}),f=(()=>{const e=l??g;return h({value:e,tabValues:a})?e:null})();(0,o.A)((()=>{f&&c(f)}),[f]);return{selectedValue:i,selectValue:(0,s.useCallback)((e=>{if(!h({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);c(e),d(e),b(e)}),[d,b,a]),tabValues:a}}var b=n(9136);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var y=n(4848);function v(e){let{className:t,block:n,selectedValue:s,selectValue:i,tabValues:o}=e;const c=[],{blockElementScrollPositionUntilNextRender:l}=(0,a.a_)(),u=e=>{const t=e.currentTarget,n=c.indexOf(t),r=o[n].value;r!==s&&(l(t),i(r))},d=e=>{let t=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const n=c.indexOf(e.currentTarget)+1;t=c[n]??c[0];break}case"ArrowLeft":{const n=c.indexOf(e.currentTarget)-1;t=c[n]??c[c.length-1];break}}t?.focus()};return(0,y.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":n},t),children:o.map((e=>{let{value:t,label:n,attributes:a}=e;return(0,y.jsx)("li",{role:"tab",tabIndex:s===t?0:-1,"aria-selected":s===t,ref:e=>{c.push(e)},onKeyDown:d,onClick:u,...a,className:(0,r.A)("tabs__item",f.tabItem,a?.className,{"tabs__item--active":s===t}),children:n??t},t)}))})}function x(e){let{lazy:t,children:n,selectedValue:a}=e;const i=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=i.find((e=>e.props.value===a));return e?(0,s.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,y.jsx)("div",{className:"margin-top--md",children:i.map(((e,t)=>(0,s.cloneElement)(e,{key:t,hidden:e.props.value!==a})))})}function A(e){const t=g(e);return(0,y.jsxs)("div",{className:(0,r.A)("tabs-container",f.tabList),children:[(0,y.jsx)(v,{...t,...e}),(0,y.jsx)(x,{...t,...e})]})}function k(e){const t=(0,b.A)();return(0,y.jsx)(A,{...e,children:d(e.children)},String(t))}}}]);