"use strict";(self.webpackChunkapp_docs=self.webpackChunkapp_docs||[]).push([[8105],{6211:(e,t,s)=>{s.d(t,{A:()=>i});s(6540);var n=s(4164);const a={tabItem:"tabItem_Ymn6"};var r=s(4848);function i(e){let{children:t,hidden:s,className:i}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,n.A)(a.tabItem,i),hidden:s,children:t})}},3283:(e,t,s)=>{s.d(t,{A:()=>k});var n=s(6540),a=s(4164),r=s(4319),i=s(6347),o=s(4280),l=s(3024),c=s(8417),u=s(4031);function d(e){return n.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,n.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:t,children:s}=e;return(0,n.useMemo)((()=>{const e=t??function(e){return d(e).map((e=>{let{props:{value:t,label:s,attributes:n,default:a}}=e;return{value:t,label:s,attributes:n,default:a}}))}(s);return function(e){const t=(0,c.XI)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,s])}function p(e){let{value:t,tabValues:s}=e;return s.some((e=>e.value===t))}function g(e){let{queryString:t=!1,groupId:s}=e;const a=(0,i.W6)(),r=function(e){let{queryString:t=!1,groupId:s}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!s)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return s??null}({queryString:t,groupId:s});return[(0,l.aZ)(r),(0,n.useCallback)((e=>{if(!r)return;const t=new URLSearchParams(a.location.search);t.set(r,e),a.replace({...a.location,search:t.toString()})}),[r,a])]}function m(e){const{defaultValue:t,queryString:s=!1,groupId:a}=e,r=h(e),[i,l]=(0,n.useState)((()=>function(e){let{defaultValue:t,tabValues:s}=e;if(0===s.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:s}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${s.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const n=s.find((e=>e.default))??s[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:r}))),[c,d]=g({queryString:s,groupId:a}),[m,f]=function(e){let{groupId:t}=e;const s=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,r]=(0,u.Dv)(s);return[a,(0,n.useCallback)((e=>{s&&r.set(e)}),[s,r])]}({groupId:a}),b=(()=>{const e=c??m;return p({value:e,tabValues:r})?e:null})();(0,o.A)((()=>{b&&l(b)}),[b]);return{selectedValue:i,selectValue:(0,n.useCallback)((e=>{if(!p({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),f(e)}),[d,f,r]),tabValues:r}}var f=s(6916);const b={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var v=s(4848);function x(e){let{className:t,block:s,selectedValue:n,selectValue:i,tabValues:o}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,r.a_)(),u=e=>{const t=e.currentTarget,s=l.indexOf(t),a=o[s].value;a!==n&&(c(t),i(a))},d=e=>{let t=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const s=l.indexOf(e.currentTarget)+1;t=l[s]??l[0];break}case"ArrowLeft":{const s=l.indexOf(e.currentTarget)-1;t=l[s]??l[l.length-1];break}}t?.focus()};return(0,v.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":s},t),children:o.map((e=>{let{value:t,label:s,attributes:r}=e;return(0,v.jsx)("li",{role:"tab",tabIndex:n===t?0:-1,"aria-selected":n===t,ref:e=>l.push(e),onKeyDown:d,onClick:u,...r,className:(0,a.A)("tabs__item",b.tabItem,r?.className,{"tabs__item--active":n===t}),children:s??t},t)}))})}function A(e){let{lazy:t,children:s,selectedValue:r}=e;const i=(Array.isArray(s)?s:[s]).filter(Boolean);if(t){const e=i.find((e=>e.props.value===r));return e?(0,n.cloneElement)(e,{className:(0,a.A)("margin-top--md",e.props.className)}):null}return(0,v.jsx)("div",{className:"margin-top--md",children:i.map(((e,t)=>(0,n.cloneElement)(e,{key:t,hidden:e.props.value!==r})))})}function y(e){const t=m(e);return(0,v.jsxs)("div",{className:(0,a.A)("tabs-container",b.tabList),children:[(0,v.jsx)(x,{...t,...e}),(0,v.jsx)(A,{...t,...e})]})}function k(e){const t=(0,f.A)();return(0,v.jsx)(y,{...e,children:d(e.children)},String(t))}},4300:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>u,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"libraries/process-tasks","title":"How AI Builders can process AI Tasks?","description":"How AI Builders can process AI Tasks?","source":"@site/docs/libraries/08-process-tasks.md","sourceDirName":"libraries","slug":"/libraries/process-tasks","permalink":"/docs/libraries/process-tasks","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8,"description":"How AI Builders can process AI Tasks?"},"sidebar":"tutorialSidebar","previous":{"title":"How Subscribers can query AI Agents?","permalink":"/docs/libraries/query-agents"},"next":{"title":"Code Examples","permalink":"/docs/libraries/examples"}}');var a=s(4848),r=s(8453),i=s(3283),o=s(6211);const l={sidebar_position:8,description:"How AI Builders can process AI Tasks?"},c="How AI Builders can process AI Tasks?",u={},d=[{value:"Benefits of delegating the API to Nevermined AI Infrastructure",id:"benefits-of-delegating-the-api-to-nevermined-ai-infrastructure",level:2},{value:"How to process AI Tasks?",id:"how-to-process-ai-tasks",level:2},{value:"AI Tasks and Steps",id:"ai-tasks-and-steps",level:3},{value:"Sending task logs dynamically",id:"sending-task-logs-dynamically",level:3}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"how-ai-builders-can-process-ai-tasks",children:"How AI Builders can process AI Tasks?"})}),"\n",(0,a.jsx)(t.admonition,{type:"note",children:(0,a.jsxs)(t.p,{children:["This feature is specific for AI Agents Services using the ",(0,a.jsx)("ins",{children:"Nevermined AI Hub"}),"."]})}),"\n",(0,a.jsx)(t.h2,{id:"benefits-of-delegating-the-api-to-nevermined-ai-infrastructure",children:"Benefits of delegating the API to Nevermined AI Infrastructure"}),"\n",(0,a.jsx)(t.p,{children:"When a AI Builder creates an AI Agent and delegates the maintenance and execution of the HTTP API to Nevermined, they can just focus in the AI piece. This has several benefits for them:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Focus on the AI"}),": The AI Builder can focus on the AI model and the AI Agent logic. Nevermined will take care of the execution of the API, authorization, etc."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Generic Interface"}),": The AI Agent will be accessible via a generic interface, the ",(0,a.jsx)(t.a,{href:"https://docs.nevermined.io/docs/protocol/query-protocol",children:"Nevermined Query Protocol"}),"."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Availability"}),": Nevermined will take care of having the AI Agent API available 24/7."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Scalability"}),": Nevermined will take care of the scaling of the AI Agent HTTP API."]}),"\n"]}),"\n",(0,a.jsx)(t.admonition,{type:"info",children:(0,a.jsxs)(t.p,{children:["Builders using the ",(0,a.jsx)(t.a,{href:"https://docs.nevermined.io/docs/protocol/query-protocol",children:"Nevermined Query Protocol"})," can process AI tasks in a simple way and generic way. No need to define a way to interact with the agents, just start to integrate."]})}),"\n",(0,a.jsx)(t.h2,{id:"how-to-process-ai-tasks",children:"How to process AI Tasks?"}),"\n",(0,a.jsx)(t.p,{children:"The AI Builders can create simple worker AI process subscribing to Nevermined to retrieving the AI tasks sent by the users."}),"\n",(0,a.jsxs)(i.A,{defaultValue:"python",values:[{label:"Python",value:"python"},{label:"Typescript",value:"typescript"}],children:[(0,a.jsx)(o.A,{value:"python",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-python",children:"import asyncio\n\nasyncio.create_task(builder.ai_protocol.subscribe(callback_function, join_account_room=True, join_agent_rooms=[], subscribe_event_types=['step-updated'], get_pending_events_on_subscribe=True))\n\ncallback_function = (step) => {\n  print('Step received', step)\n  await payments.ai_protocol.update_step(did=step['did'], \n    task_id=step['task_id'], \n    step_id=step['step_id'], \n    step={'step_id': step['step_id'],\n      'task_id': step['task_id'], \n      'step_status': AgentExecutionStatus.Completed.value,\n      'output': 'success',\n      'is_last': True,\n      'cost': 1\n    })\n}\n"})})}),(0,a.jsx)(o.A,{value:"typescript",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",children:"const opts = {\n  joinAccountRoom: true, // To subscribe to all the events related to the account\n  joinAgentRooms: [], // To which agents the agent wants to subscribe. This is useful for AI developers who want to process several agents tasks in parallel\n  subscribeEventTypes: ['step-updated'], // To which events the agent wants to subscribe\n  getPendingEventsOnSubscribe: true // To get the pending events when the agent connects\n}\n\nawait paymentsBuilder.query.subscribe(callbackFunction, opts)\n\nconst callbackFunction = (data: any) => {\n  console.log('Step received', data)\n  const step = JSON.parse(data)\n  await paymentsBuilder.query.updateStep(step.did, {\n    step_id: step.step_id,\n    task_id: step.task_id,\n    step_status: AgentExecutionStatus.Completed,\n    is_last: true,\n    output: 'LFG!',\n    cost: 1\n  })\n}\n"})})})]}),"\n",(0,a.jsx)(t.p,{children:"Using this, create an AI Agent is as simple as calling a subscribe and resolving the steps part of the tasks."}),"\n",(0,a.jsx)(t.p,{children:"As you can see in the above code, the agent can subscribe to the events related with AI tasks created by the users and process them. For doing that it just needs to implement a callback function that will get the AI task input parameters and process it."}),"\n",(0,a.jsx)(t.h3,{id:"ai-tasks-and-steps",children:"AI Tasks and Steps"}),"\n",(0,a.jsx)(t.p,{children:"The AI tasks are composed by several steps. Each step is a part of the task that the AI Agent needs to process. The steps are processed sequentially and the agent can update the status of the step and the output of the step. You can see the steps as a workflow that the AI Agent needs to process to be completed."}),"\n",(0,a.jsxs)(t.p,{children:["The AI Agent only needs to process the steps and update the status of the step and the output of the step. The rest of the logic is managed by ",(0,a.jsx)(t.strong,{children:"Nevermined AI Hub"}),"."]}),"\n",(0,a.jsxs)(t.p,{children:["When a user requests a task to an AI Agent, by default is created one task with one step. This first step has the ",(0,a.jsx)(t.strong,{children:'"init"'})," name. When the AI agent receives the ",(0,a.jsx)(t.strong,{children:"init"})," step can:"]}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:["If the AI task is simple and ",(0,a.jsx)(t.strong,{children:"doesn't require several steps"}),", it can process the step and update the status of the step to ",(0,a.jsx)(t.strong,{children:"Completed"})," and the ",(0,a.jsx)(t.strong,{children:"is_last"})," attribute as ",(0,a.jsx)(t.strong,{children:"true"}),". This will mark the whole task as completed."]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:["If the AI task requires ",(0,a.jsx)(t.strong,{children:"multiple steps"}),", the AI Agent can create more steps and setup the order of execution and configuration of them. This can be done by defining the ",(0,a.jsx)(t.strong,{children:"name"}),", ",(0,a.jsx)(t.strong,{children:"order"})," and ",(0,a.jsx)(t.strong,{children:"predecessor"})," step."]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"We will see different code examples about how to do this in the following section."}),"\n",(0,a.jsx)(t.h3,{id:"sending-task-logs-dynamically",children:"Sending task logs dynamically"}),"\n",(0,a.jsxs)(t.p,{children:["The execution of an AI task can be long and the user can want to know the status of the task. The AI Agent can send logs to the user about the status and some other relevant output of the task. This can be done using the ",(0,a.jsx)(t.code,{children:"log_task (python)"})," or ",(0,a.jsx)(t.code,{children:"logTask (typescript)"})," methods."]}),"\n",(0,a.jsx)(t.admonition,{type:"tip",children:(0,a.jsxs)(t.p,{children:["When your task finishes with a ",(0,a.jsx)(t.code,{children:"Completed"})," or ",(0,a.jsx)(t.code,{children:"Failed"})," status, you can send a log message witht that status. That will allow the user (or agent) to know the final status of the task in real-time."]})}),"\n",(0,a.jsx)(t.p,{children:"Let's see an example:"}),"\n",(0,a.jsxs)(i.A,{defaultValue:"python",values:[{label:"Python",value:"python"},{label:"Typescript",value:"typescript"}],children:[(0,a.jsx)(o.A,{value:"python",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-python",children:"await self.payment.ai_protocol.log_task(\n  TaskLog(\n    task_id=step['task_id'], \n    message='Summary ready.', \n    level='info', \n    task_status=AgentExecutionStatus.Completed.value\n  )\n)\n\n"})})}),(0,a.jsx)(o.A,{value:"typescript",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",children:"const logMessage: TaskLogMessage = {\n    task_id: step.task_id,\n    level: 'info',\n    task_status: AgentExecutionStatus.Completed,\n    message: `Step ${step.name} : ${step.step_id} completed!`,\n}\nawait payments.query.logTask(logMessage)\n\n"})})})]}),"\n",(0,a.jsx)(t.p,{children:"These logs will be send via websocket and the user who sent the task can see them in real time."})]})}function p(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},8453:(e,t,s)=>{s.d(t,{R:()=>i,x:()=>o});var n=s(6540);const a={},r=n.createContext(a);function i(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);