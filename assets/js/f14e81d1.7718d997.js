"use strict";(self.webpackChunkapp_docs=self.webpackChunkapp_docs||[]).push([[509],{7362:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>p,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>l,toc:()=>u});var i=t(5893),r=t(1151),s=t(7691),a=t(7294);function o(){const[n,e]=(0,a.useState)(!1),[t,r]=(0,a.useState)(!1),[o,c]=(0,a.useState)(""),d=(0,a.useRef)(new s.Payments({returnUrl:"https://docs.nevermined.app/docs/tutorials/integration/nextjs-react-payments#try-it-out",environment:"appStaging",appId:"app-docs",version:"v0.1.4"}));return(0,a.useEffect)((()=>{d.current.init()}),[]),(0,a.useEffect)((()=>{d.current.isLoggedIn&&e(!0)}),[d.current.isLoggedIn]),(0,i.jsx)("main",{children:(0,i.jsxs)("div",{children:[!n&&(0,i.jsx)("button",{onClick:()=>{d.current.connect()},children:"Log in"}),n&&(0,i.jsx)("button",{onClick:()=>{d.current.logout(),e(d.current.isLoggedIn)},children:"Log out"}),(0,i.jsx)("button",{disabled:!n,onClick:async function(){if(d.current.isLoggedIn){r(!0);const{did:n}=await d.current.createSubscription({name:"test subscription",description:"test",price:10000000n,tokenAddress:"0x75faf114eafb1BDbe2F0316DF893fd58CE46AA4d",duration:30,tags:["test"]});r(!1),c(n)}},children:"Create Subscription"}),(0,i.jsx)("p",{children:t&&""===o?"Creating Subscription, please wait a few seconds...":(0,i.jsx)("a",{href:`https://staging.nevermined.app/subscription/${o}`,children:o})})]})})}const c={sidebar_position:3,description:"How to integrate the Nevermined Payments library in a react application"},d="Tutorial on how to use the Nevermined Payments Protocol in a React app",l={id:"tutorials/integration/nextjs-react-payments",title:"Tutorial on how to use the Nevermined Payments Protocol in a React app",description:"How to integrate the Nevermined Payments library in a react application",source:"@site/docs/tutorials/integration/nextjs-react-payments.mdx",sourceDirName:"tutorials/integration",slug:"/tutorials/integration/nextjs-react-payments",permalink:"/docs/tutorials/integration/nextjs-react-payments",draft:!1,unlisted:!1,editUrl:"https://github.com/nevermined-io/app_docs/tree/main/docs/tutorials/integration/nextjs-react-payments.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,description:"How to integrate the Nevermined Payments library in a react application"},sidebar:"tutorialSidebar",previous:{title:"Using the Nvm App API",permalink:"/docs/tutorials/integration/api-integration"},next:{title:"For Web3 users",permalink:"/docs/tutorials/web3/"}},p={},u=[{value:"Initializing the project",id:"initializing-the-project",level:3},{value:"Initialize the payments library",id:"initialize-the-payments-library",level:3},{value:"Create a subscription",id:"create-a-subscription",level:3},{value:"Try it out",id:"try-it-out",level:3},{value:"Full code",id:"full-code",level:3}];function m(n){const e={a:"a",code:"code",h1:"h1",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.a)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h1,{id:"tutorial-on-how-to-use-the-nevermined-payments-protocol-in-a-react-app",children:"Tutorial on how to use the Nevermined Payments Protocol in a React app"}),"\n",(0,i.jsx)(e.h3,{id:"initializing-the-project",children:"Initializing the project"}),"\n",(0,i.jsxs)(e.p,{children:["For this tutorial we will be using ",(0,i.jsx)(e.a,{href:"https://nextjs.org/docs/getting-started/installation",children:"nextjs"}),"\ncreate our react application."]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"Initialize the react project"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"npx create-next-app@latest\n"})}),"\n",(0,i.jsxs)(e.ol,{start:"2",children:["\n",(0,i.jsxs)(e.li,{children:["Install the Nevermined ",(0,i.jsx)(e.a,{href:"https://github.com/nevermined-io/payments",children:"payments library"})]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"yarn add @nevermined-io/payments\n"})}),"\n",(0,i.jsxs)(e.ol,{start:"3",children:["\n",(0,i.jsx)(e.li,{children:"Starting the development server"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"yarn dev\n"})}),"\n",(0,i.jsx)(e.h3,{id:"initialize-the-payments-library",children:"Initialize the payments library"}),"\n",(0,i.jsxs)(e.p,{children:["In order to initialize the payments library we need to have the user login to Nevermined. This can\nbe achieved by calling the ",(0,i.jsx)(e.code,{children:"connect"})," method that will redirect the user to the Nevermined for Login\nand once the user is returned to the app calling the ",(0,i.jsx)(e.code,{children:"init"})," method to finalize the initialization of\nthe payments library."]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-tsx",metastring:'title="/app/page.tsx"',children:"'use client'\n\nimport { useEffect } from 'react'\nimport { Payments } from '@nevermined-io/payments'\n\nexport default function Home() {\n  const payments = new Payments({\n    returnUrl:\n      'https://docs.nevermined.app/docs/tutorials/integration/nextjs-react-payments#try-it-out',\n    environment: 'staging',\n  })\n\n  const onLogin = () => {\n    payments.connect()\n  }\n\n  useEffect(() => {\n    payments.init()\n  }, [])\n\n  return (\n    <main>\n      <div>\n        <button onClick={onLogin}>Login</button>\n      </div>\n    </main>\n  )\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"create-a-subscription",children:"Create a subscription"}),"\n",(0,i.jsx)(e.p,{children:"Once the app is initialized we can start interacting with the Nevermined Payments Protocol. Here is\na example for creating a subscription"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-tsx",metastring:'title="/app/page.tsx"',children:"  ...\n\n  async function createSubscription() {\n    if (payments.isLoggedIn) {\n      const { did } = await payments.createSubscription({\n        name: 'test subscription',\n        description: 'test',\n        price: 10000000n,\n        tokenAddress: '0x75faf114eafb1BDbe2F0316DF893fd58CE46AA4d',\n        duration: 30,\n        tags: ['test'],\n      })\n    }\n\n    return (\n    <main>\n      <div>\n        <button onClick={onLogin}>Login</button>\n        <button onClick={createSubscription}>Create Subscription</button>\n      </div>\n    </main>\n  )\n  }\n"})}),"\n",(0,i.jsx)(e.h3,{id:"try-it-out",children:"Try it out"}),"\n",(0,i.jsx)(o,{}),"\n",(0,i.jsx)(e.h3,{id:"full-code",children:"Full code"}),"\n",(0,i.jsxs)(e.p,{children:["For the full nextjs example please check\n",(0,i.jsx)(e.a,{href:"https://github.com/nevermined-io/tutorials/tree/main/payments-nextjs-example",children:"payments-nextjs-example"})]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-tsx",metastring:'title="app/page.tsx"',children:"import { useEffect, useState, useRef } from 'react'\nimport { Payments } from '@nevermined-io/payments'\n\nexport default function PaymentsTutorial() {\n  const [isUserLoggedIn, setIsUserLoggedIn] = useState<boolean>(false)\n  const [creatingSubscription, setCreatingSubscription] = useState<boolean>(false)\n  const [did, setDid] = useState<string>('')\n\n  const payments = useRef(\n    new Payments({\n      returnUrl:\n        'https://docs.nevermined.app/docs/tutorials/integration/nextjs-react-payments#try-it-out',\n      environment: 'appStaging',\n      appId: 'app-docs',\n      version: 'v0.1.4'\n    }),\n  )\n\n  const onLogin = () => {\n    payments.current.connect()\n  }\n\n  const onLogout = () => {\n    payments.current.logout()\n    setIsUserLoggedIn(payments.current.isLoggedIn)\n  }\n\n  useEffect(() => {\n    payments.current.init()\n  }, [])\n\n  useEffect(() => {\n    if (payments.current.isLoggedIn) {\n      setIsUserLoggedIn(true)\n    }\n  }, [payments.current.isLoggedIn])\n\n  async function createSubscription() {\n    if (payments.current.isLoggedIn) {\n      setCreatingSubscription(true)\n      const { did } = await payments.current.createSubscription({\n        name: 'test subscription',\n        description: 'test',\n        price: 10000000n,\n        tokenAddress: '0x75faf114eafb1BDbe2F0316DF893fd58CE46AA4d',\n        duration: 30,\n        tags: ['test'],\n      })\n      setCreatingSubscription(false)\n      setDid(did)\n    }\n  }\n\n  return (\n    <main>\n      <div>\n        {!isUserLoggedIn && <button onClick={onLogin}>{\"Log in\"}</button>}\n        {isUserLoggedIn && <button onClick={onLogout}>{\"Log out\"}</button>}\n\n        <button onClick={createSubscription}>Create Subscription</button>\n        <p>\n          {creatingSubscription && did === '' ? (\n            'Creating Subscription, please wait a few seconds...'\n          ) : (\n            <a href={`https://staging.nevermined.app/subscription/${did}`}>{did}</a>\n          )}\n        </p>\n      </div>\n    </main>\n  )\n}\n"})})]})}function h(n={}){const{wrapper:e}={...(0,r.a)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(m,{...n})}):m(n)}}}]);